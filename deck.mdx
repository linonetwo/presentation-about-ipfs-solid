# IPFS 作为 Solid 存储层
---
# 社交互联数据

Solid 是 social linked data (社交互联数据) 的缩写，简单来介绍就是一个可以把现在分散在微信朋友圈、微博、推特等等产品上的自己几十个账号内的数据都保存到一个地方的分布式社交应用设计规范。

按着它来的话应用的用户可以把数据存到自己想存的存储空间里，而不是疼讯、新浪或者某国外不存在公司的服务器上。
---
# 更具体的好处

1. 永远拥有我们的数据，不怕倒闭不怕墙；
1. 让多个应用的数据互联，你在《时间块》里生产的数据能零成本地用来发微博；
1. 鼓励社区创新出更多 Web 应用，因为不再需要冷启动了，新的应用可以直接授权使用你的现有数据；
1. 让应用和数据拥有不同的生命周期，比如用一直存在的微信应用来生产只需要存在一周的闲聊，或者用一个只需要存在一周的企业级小工具生产和这个企业永远相伴的重要数据。
---
# 去中心化

通过 Solid 产生的数据并是去中心化存储的，存放在像 Dropbox 这样的网盘里面，这种能存放 Solid 产生的智能数据的网盘称为 POD。
---
这样的数据存储虽然并不是保存在我们的个人电脑上，看似是违背了 Solid 技术栈的初衷，但我们其实可以在多家互相竞争的数据存储服务商之间自由选择，这样我们的信息其实是去中心化存储的（注意不是分布式存储）。

因为避开了中心化数据存储，所有 Solid 应用还是能带着互联网走向设计之初设想的样子。而且使用专业的第三方存储提供商也可以降低普通用户的使用门槛。
---
# 分布式

POD 限速了不方便分发？在火星访问在地球的 POD？

POD 倒闭了怎么办？如何让自己的数据在多个 POD 之间自由迁移？

POD 限制大文件上传了？小站长自建 POD 服务结果发现流量负担大？
---
# 使用 IPFS 的问题

IPFS 网络上的内容是所有人都可以访问的，除非：

- 你在添加文件到 IPFS 前对其加密，像 AES 这样的算法就不错；
- 你使用私有的 IPFS 网络，这可以通过移除所有默认的启动节点（Bootstrap Node），并把你的私有网络中的节点作为启动节点来实现。
---
在 IPFS 上启动 Solid 服务器很简单，如果你能修改代码的话，把[这个位置把文件写入本地文件系统的操作](https://github.com/solid/node-solid-server/blob/66f56e04eecfd1c9dc5c3abc8a551f7777bd4ba5/lib/ldp.js#L278) 改成写入 IPFS 就好了。

```js
const file = stream.pipe(fs.createWriteStream(filePath))
```

```js
const file = this.node.files.addReadableStream().write(stream)
```
---
添加文件到 IPFS 上的主要意义在于，数据此时可以通过 IPFS 从一台服务器同步到另一台服务器。

但前提是 POD 要维护一份里面文件的列表，包含这些文件的 multihash，从而另一个 POD 能够看着这份列表把所有文件同步过来。
---
可以在浏览器中动态创建 POD，并在把数据保存到 IPFS 后，请求某个 Pin Service 保存刚放到本地 IPFS repo 里的数据，例如你的手机。

不信任第三方 POD 的用户
---
# 分布式应用（DApp）

最简单的分布式应用就是通过 IPFS 分发的普通 Web 应用，只不过这些应用没有后端，读写数据都发生在 IPFS 上，开发者开发完应用后把 HTML、JS 和其他静态文件上传到 IPFS 上.

然后用户就可以通过某个 IPFS 网关，比如 ```ipfs.io/ipfs/``` 来访问这个应用，网关会把文件从 IPFS 上取下来，然后通过 HTTP 发给用户。当然，FireFox 等浏览器也会支持直接打开在 IPFS 上的文件。
---
# Solid 数据

POD 上的数据遵从 LDP（互联数据平台） 规范.

被应用放在 LDP 上的最重要的数据是互联数据，比如 [turtle 三元组语言描述的个人信息页](https://linonetwo.inrupt.net/profile/card)，背后是[这样的](view-source:https://linonetwo.databox.me/Preferences/prefs.ttl)。
---
那为什么要放互联数据呢？如下图可见，容器直接标明了里面的两个文件的类型是 ```p:product``` ，因此任何访问这个容器的自动程序都能理解这个容器是用来放某种产品的。像之前说过的那样，这种程序的理解能力不需要高深的人工智能，但是对用户来说它的这种理解能力就是很智能。所以通过添加互联数据我们用户可以几乎零成本地使用一大堆「人工智能」应用。

![Using domain vocabularly with a Direct container](https://www.w3.org/TR/ldp-primer/dc1.png)
---
还有一种常见数据就是图片、文档、PPT、程序安装包之类的任意类型的东西，你能往网盘里存什么，就能往 LDP 里放什么。比如上图中的两个 Product Resource 可能就是新旧两个版本的，色情游戏软件安装包。新版的色情游戏中为了维护和谐社会给所有东西都打了码，而原版色情图片中如下图可见，所有东西都没打码。

![图片]()
---
最后，还有一种关键的资源，就是用来放上述资源的资源，LDPC（Linked Data Platform Container）也就是互联数据平台容器，像一个文件夹，但它不能是单纯的存储东西的文件夹，还得能响应 REST 请求，从而在文件夹里创建新的互联数据、图片、文档。[例如](https://www.w3.org/TR/ldp-primer/#docstore) 通过 PUT 方法来大量更新文档内容，PATCH 方法来增量更新文档内容，DELETE 方法来删除文档。
---
|路径|方法|描述|
|--- |--- |--- |
|/tracker/{product-id}/|GET|列出 product-id 对应的产品的描述信息，还有这个产品相关的 bug 报告|
|/tracker/{product-id}/|POST|创建一个 product-id 对应的产品的 bug 报告|
|/tracker/{product-id}/|PUT|更新 product-id 对应的产品的描述文档|
|/tracker/{product-id}/|DELETE|删除 product-id 对应的产品的描述信息，还有这个产品相关的 bug 报告|
|/tracker/{product-id}/{bug-id}|GET|读取 product-id 下的 bug-id 对应的 bug 报告|
|/tracker/{product-id}/{bug-id}|PUT|更新 bug 报告|
|/tracker/{product-id}/{bug-id}|DELETE|删除 bug 报告|
|/tracker/\*/\*|OPTIONS|用于看某个资源允许哪些 REST 方法|
|/tracker/\*/\*|HEAD|只读取某个资源的元信息|
---
很多用户可能会选择把自己写的文章拍的短视频发到一个中转节点上，并订阅这个中转节点上其他人生产的内容。[[14]](#14)

这个中转节点可能是一个中心化的服务器，比如泛用无界角色扮演平台上有很多语言cos线程（即帖子），当用户订阅了某个线程之后，浏览器通过 POST 请求把用户的 WebID 发给这个线程的收件箱，并维护一个与服务器的长连接，从而在有新的回复时及时通知用户。

如果用户出于情怀等原因不愿意连接到一个中心化服务器，她使用的 Web 应用会直接把她说的话保存到 IPFS 上，此时其他用户有两种选择来获取最新的对白，一是通过与其他 Web 应用之间的 pubsub 来获得 p2p 推送；二是 Web 应用在开启状态下会不断轮询一个 LDP 容器，看看有没有新的内容放进去。
---
# 身份认证

我们知道以太坊钱包它不需要你提供一个密码，因为没有一个中心服务器给你存密码，以太坊的身份校验是通过公钥和私钥。
---
WebID 也很类似，我们首先要生成一份公钥放在我们的页面上（放在 ```https://linonetwo.inrupt.net/profile/card``` 里），然后把配套的私钥存在浏览器里（或者一个专用的密码管理器，类似于 MetaMask，或者一个冷钱包），接着当你打开一个有一定权限管理的程序的时候，如下图的事情就会发生：

![验证身份](https://www.w3.org/2005/Incubator/webid/spec/tls/img/WebIDSequence-friendly.png)
---
![验证身份](https://www.w3.org/2005/Incubator/webid/spec/tls/img/WebIDSequence-friendly.png)

1. 鲍博士的浏览器和爱丽丝的服务器建立 HTTPS 连接；
1. 鲍博士的浏览器发出一个 REST 请求，去请求某个数据；
1. 权限控制网关这时候就会先检查一下这个数据有没有加访问权限，如果它就是个公开数据，那就直接返回给鲍博士。但很可惜这是一份机密的情书，所以只有通过权限检验的人才能看到。
1. 那这时候爱丽丝的服务器就要进行权限检验了，第一步就是确认此时请求文件的人就是鲍博士本人。那爱丽丝的服务器就请鲍博士的浏览器发送一个证书，上面带着鲍博的 WebID 和公钥，这时候鲍博的浏览器就会弹一个框上面可能有鲍博的大号和小号，让他点击选一个账号，这个 WebID 就带着相应的公钥填进证书里，点完之后这个证书就会用鲍博浏览器上（或者一个专用的密码管理器里）的私钥签名 [[9]](#9) 之后，发给爱丽丝的服务器；
1. 爱丽丝的服务器满意地收到了证书，把证书交给权限校验程序（黄色的框）；
1. 校验程序就拿证书里填的 WebID 去访问一下，取鲍博的个人信息，然后因为 WebID 就是一个 URI，指向鲍博自己搭的服务器上的个人信息页面，所以访问一下就能拿到个人信息；
1. 校验程序拿着信息一比对，感觉这个发证书的鲍博应该就是 WebID 所说的那个鲍博，那就可以拿这个身份去跑一下权限检验看他能不能读这个数据 [[11]](#11)，比如必须鲍博必须要在爱丽丝的社交图谱中是比较核心的朋友才能通过这个文件的校验 [[8]](#8)；
1. 鲍博通过了校验，他之前的那个请求数据的 REST 请求返回了相应的数据。
---
1. 身份认证
1. 个人信息主页
1. 鉴权和对内容的访问控制
1. 内容存储和读写
1. 怎么关注别人还有接收推送
---
按照 Solid 规范制作的应用和服务具有很强的互操作性，也就是数据都打通了，没有隔阂和壁垒，因此对于某个需求比如聊天需求，会涌现出来各种竞品，用户可以选择符合自己个性感觉最好用的那一个，而且还会出现各种智能程序自动做一些简单的脑力劳动，利用人们产生的数据解放出更多的生产力。
---